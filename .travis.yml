language: cpp

matrix:
  include:
    - os: linux
      dist: xenial
    - os: osx
      osx_image: xcode9.3

addons:
  apt:
    sources:
      - sourceline: 'ppa:ubuntu-sdk-team/ppa'
    packages:
      - qt5-default
      - qttools5-dev-tools
      - qtmultimedia5-dev
      - libqt5multimedia5-plugins
      - libasound2-dev
      - libjack-dev
      - libpulse-dev
  homebrew:
    packages:
      - qt
    update: true

git:
  depth: 3

branches:
  only:
    - master
    - "/^v[0-9\\.]+$/"

before_install:
  # osx: force linking of qt into PATH
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew link --force qt; fi

script:
  - cd BambooTracker
  - qmake
  - make

before_deploy:
  - macdeployqt BambooTracker.app -verbose=2
  - mv .qm lang
  - mv lang BambooTracker.app/Contents/Resources
  - mv BambooTracker.app ..
  - cd ..
  - zip -r BambooTracker-$TRAVIS_TAG-macOS.zip BambooTracker.app *.md img demos licenses specs skins LICENSE

deploy:
  provider: releases
  api_key:
    secure: bs+nLxg+IeepN/gyUHN//I1pPvKDMXiAGF7aE8vOW7c6ZeJMoUIGydJkNzsPWIKnRhMa5RYlOXM+9/eMzYe0JAC2cVj/Zo2IMeRVYqeQDrKZ1my6CMGGvE0dUnSHXIezN0+Z4SP+p6HRRF20FLqthz/3ICWiqoSo1/HFHnj5nDCG2Ni++Xt5PFVBOa6sp9CzDBtm9I8xBwoieZFwUpU/BMOqlHHHoQ09YSdzCdu0E544bAh7RXgmyl+ayYD8klVhf5p82oynnMliAdj0IOlPRETyBhhdXXv5/Eivtoo9e5bvlbEwuuy8yvbZl9LW0fQLobB2o/2eYNtDpxOciLOZQaj8EvjhOPVeyAlEKi28VOusYFVrGk3UEuN5HoxMPdwWRJWylgcsYd1ZWS907ccj9XLrF4bVpyPOhvYiLA1zgIU+nk5B7NWqzQjcNEQK4jx+UeJURLpZMS8F1lyLlNJeWr3b5E0+6+nTmgeq5E7jGwdhUraje6W5hmXlwrKvoJ8kFnKDyRKuNCvtnoBX7XvJl7iYmp4FvQfgSWFOkIIvWdGPbByMff6vYrXU3WvkGPLErZuM9ivj7HCwx55xiBimKZCiUgrTPrbgN4KJfcnA9YbgumoF9K4xdvQmBLxV5S/LIm7pUJS5+PSyZM+PNfsbuapYPQWfdTH5/ZGetdUNgV0=
  file: $TRAVIS_BUILD_DIR/BambooTracker-$TRAVIS_TAG-macOS.zip
  skip_cleanup: true
  on:
    repo: rerrahkr/BambooTracker
    tags: true
    condition: $TRAVIS_OS_NAME = osx
